\documentclass[12pt,a4paper,openany]{book}

% ===== PACKAGES =====
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{microtype}
\usepackage{amsmath,amssymb,amsthm}
\usepackage{graphicx}
\usepackage{xcolor}
\usepackage{tikz}
\usepackage{listings}
\usepackage{hyperref}
\usepackage{booktabs}
\usepackage{enumitem}
\usepackage{fancyhdr}
\usepackage{titlesec}
\usepackage{tcolorbox}
\usepackage{fontawesome5}
\usepackage{mdframed}
\usepackage{subcaption}
\usepackage{wrapfig}
\usepackage{gensymb}

% ===== GEOMETRY - SMALLER MARGINS =====
\usepackage[
    top=3cm,
    bottom=3cm,
    left=3cm,
    right=3cm,
    marginparwidth=1.8cm,
    marginparsep=0.3cm,
    headheight=15pt,
    headsep=1cm,
    footskip=1cm
]{geometry}

% ===== COLORS =====
\definecolor{noteblue}{RGB}{13, 110, 253}
\definecolor{tipgreen}{RGB}{25, 135, 84}
\definecolor{importantorange}{RGB}{255, 149, 0}
\definecolor{warningyellow}{RGB}{255, 193, 7}
\definecolor{cautionred}{RGB}{220, 53, 69}
\definecolor{codegray}{RGB}{248, 249, 250}
\definecolor{linkblue}{RGB}{0, 123, 255}

% ===== HYPERREF SETUP =====
\hypersetup{
    colorlinks=true,
    linkcolor=linkblue,
    citecolor=linkblue,
    urlcolor=linkblue,
    bookmarksdepth=3,
    pdfborder={0 0 0}
}

% ===== GITHUB-STYLE CALLOUT BOXES =====
\tcbuselibrary{skins,breakable}

% Base style for all callouts - GitHub-like design
\tcbset{
    calloutbase/.style={
        enhanced,
        breakable,
        sharp corners,
        colback=white,
        colframe=#1,
        borderline west={3pt}{0pt}{#1},
        boxrule=1pt,
        left=12pt,
        right=8pt,
        top=8pt,
        bottom=8pt,
        fonttitle=\bfseries\sffamily\small,
        coltitle=#1,
        title style={left color=#1!10, right color=#1!5},
        before skip=1.5\baselineskip,
        after skip=1.5\baselineskip,
    }
}

% NOTE callout - Blue theme
\newtcolorbox{noteblock}{
    calloutbase=noteblue,
    colback=noteblue!3,
    title={\textcolor{noteblue}{\faInfoCircle}\ \textcolor{noteblue}{NOTE}}
}

% TIP callout - Green theme  
\newtcolorbox{tipblock}{
    calloutbase=tipgreen,
    colback=tipgreen!3,
    title={\textcolor{tipgreen}{\faLightbulb}\ \textcolor{tipgreen}{TIP}}
}

% IMPORTANT callout - Orange theme
\newtcolorbox{importantblock}{
    calloutbase=importantorange,
    colback=importantorange!3,
    title={\textcolor{importantorange}{\faExclamationCircle}\ \textcolor{importantorange}{IMPORTANT}}
}

% WARNING callout - Yellow theme
\newtcolorbox{warningblock}{
    calloutbase=warningyellow,
    colback=warningyellow!3,
    title={\textcolor{warningyellow!80!black}{\faExclamationTriangle}\ \textcolor{warningyellow!80!black}{WARNING}}
}

% CAUTION callout - Red theme
\newtcolorbox{cautionblock}{
    calloutbase=cautionred,
    colback=cautionred!3,
    title={\textcolor{cautionred}{\faExclamationTriangle}\ \textcolor{cautionred}{CAUTION}}
}
% ===== CODE LISTINGS - C LANGUAGE =====
\lstset{
    backgroundcolor=\color{codegray},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    commentstyle=\color{gray},
    frame=single,
    frameround=tttt,
    framesep=5pt,
    keywordstyle=\color{blue},
    language=C,
    numbers=left,
    numbersep=5pt,
    numberstyle=\tiny\color{gray},
    rulecolor=\color{black},
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    stringstyle=\color{red},
    tabsize=4,
    morekeywords={size_t, ssize_t, socklen_t, struct, typedef}
}

% ===== CHAPTER AND SECTION FORMATTING =====
\titleformat{\chapter}[display]
  {\normalfont\huge\bfseries\sffamily}
  {\chaptertitlename\ \thechapter}
  {20pt}
  {\Huge}
  
\titleformat{\section}
  {\normalfont\Large\bfseries\sffamily}
  {\thesection}
  {1em}
  {}
  
\titleformat{\subsection}
  {\normalfont\large\bfseries\sffamily}
  {\thesubsection}
  {1em}
  {}

% ===== HEADER AND FOOTER =====
\pagestyle{fancy}
\fancyhf{}
\fancyhead[LE]{\small\sffamily\color{darkblue}\nouppercase{\leftmark}}
\fancyhead[RO]{\small\sffamily\color{darkblue}\nouppercase{\rightmark}}
\fancyfoot[C]{\small\sffamily\color{darkblue}\thepage}
\renewcommand{\headrulewidth}{0.5pt}
\renewcommand{\headrule}{\hbox to\headwidth{\color{darkblue!30}\leaders\hrule height \headrulewidth\hfill}}
\renewcommand{\footrulewidth}{0pt}

\fancypagestyle{plain}{
    \fancyhf{}
    \fancyfoot[C]{\small\sffamily\color{darkblue}\thepage}
    \renewcommand{\headrulewidth}{0pt}
    \renewcommand{\footrulewidth}{0pt}
}

% ===== THEOREM ENVIRONMENTS =====
\theoremstyle{definition}
\newtheorem{definition}{Definition}[chapter]
\newtheorem{example}{Example}[chapter]
\newtheorem{protocol}{Protocol}[chapter]

\theoremstyle{plain}
\newtheorem{theorem}{Theorem}[chapter]
\newtheorem{lemma}{Lemma}[chapter]

% ===== DOCUMENT METADATA =====
\title{Computer Networks: Course Reader}
\author{Computer Networks TAs et al.}
\date{Latest revision: \today}


% ===== FONT SETUP =====
\usepackage{charter} % Charter for main text
\usepackage[expert]{mathdesign} % Matching math fonts for Charter
\usepackage[scaled=0.9]{helvet} % Helvetica for sans-serif
\usepackage[scaled=0.85]{FiraMono} % Fira Code for monospace
\renewcommand{\sfdefault}{phv} % Ensure Helvetica is used for sans-serif


% ===== OTHER =====
\setlength{\parindent}{0pt}
\setlength{\parskip}{0.5\baselineskip}
\setcounter{tocdepth}{1}
% link color dark blue
\definecolor{darkblue}{RGB}{0, 51, 102}
\hypersetup{
    linkcolor=darkblue,
    citecolor=darkblue,
    urlcolor=darkblue
}

\input{version.tex} % Include version command
% Version stamp using draftwatermark
\usepackage[firstpageonly=true]{draftwatermark}
\SetWatermarkText{\sffamily\bfseries\version!}
\SetWatermarkScale{0.5}
\SetWatermarkAngle{-30}
\SetWatermarkHorCenter{0.8\paperwidth}
\SetWatermarkVerCenter{0.11\paperheight}
\SetWatermarkLightness{0.85}
\SetWatermarkColor{darkblue!10!white}


\begin{document}

% ===== TITLE PAGE =====
\frontmatter
\begin{titlepage}
    \vspace*{\fill}
    \centering
    {\fontsize{40}{48}\selectfont\bfseries\sffamily Computer Networks}\\[0.5cm]
    {\fontsize{30}{36}\selectfont\sffamily Course Reader}

    \vspace{1.5cm}

    \begin{tikzpicture}
        \draw[thick, darkblue] (0,0) -- (14,0);
        \fill[darkblue] (7,0) circle (3pt);
    \end{tikzpicture}

    \vspace{2cm}

    {\fontsize{20}{24}\selectfont\sffamily Computer Networks TAs et al.}

    \vspace*{\fill}

    % Bottom section with date and version
    \centering

    {\fontsize{16}{19}\selectfont\sffamily\textbf{Latest Revision:} \today}\\[0.3cm]
    \vspace{0.5cm}
    \includegraphics[width=0.5\textwidth]{assets/rug.png}

    \vspace{1cm}
    
\end{titlepage}

\newpage
\thispagestyle{empty}
\mbox{}
% ===== TABLE OF CONTENTS =====
\tableofcontents

% Clear headers for preface
\markboth{}{}
\input{sections/0_preface}

% ===== MAIN CONTENT =====
\mainmatter
% ---- Setup and Introduction ----
\input{sections/1_setup.tex}
\input{sections/osi/1_intro.tex}

% Physical Layer
\input{sections/network/1_mediums.tex}
\input{sections/network/2_modulation.tex}
\input{sections/network/3_multiplexing.tex}
% ===== APPENDICES =====
\appendix


% ===== BACK MATTER =====
\backmatter
\listoffigures
\listoftables
\chapter*{Contributions}\label{sec:contributions}
\input{contributors.tex}
\end{document}